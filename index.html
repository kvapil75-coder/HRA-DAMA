<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <title>D√°ma ‚Äì hr√°ƒç vs. automat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: system-ui, sans-serif;
      background: #202124;
      color: #fff;
      text-align: center;
      padding: 20px;
    }

    #game {
      max-width: 520px;
      margin: 0 auto;
      background: #2b2d31;
      padding: 16px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.5);
    }

    #board {
      margin: 16px auto;
      width: 420px;
      max-width: 90vw;
      aspect-ratio: 1 / 1;
      display: grid;
      grid-template-columns: repeat(8, 1fr);
      border: 4px solid #444;
    }

    #score {
      margin-top: 8px;
      font-weight: 600;
    }

    .square {
      position: relative;
      box-sizing: border-box;
    }

    .light {
      background: #f0d9b5;
    }

    .dark {
      background: #b58863;
    }

    .square.selected {
      outline: 3px solid #ffeb3b;
      outline-offset: -3px;
    }

    .piece {
      width: 70%;
      height: 70%;
      border-radius: 50%;
      margin: auto;
      margin-top: 15%;
      box-sizing: border-box;
      cursor: pointer;
      position: relative;   /* pro korunku */
      display: block;       /* ≈æ√°dn√Ω flex, a≈• se nic nedeformuje */
      overflow: hidden;
    }

    .piece.white {
      background: #fafafa;
      border: 2px solid #ddd;
    }

    .piece.black {
      background: #111;
      border: 2px solid #444;
    }

    .piece.king {
      box-shadow: 0 0 6px rgba(255, 215, 0, 0.9);
    }

    .crown {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 16px;
      line-height: 1;
      pointer-events: none;
    }

    #info {
      margin-top: 8px;
      font-weight: bold;
      min-height: 1.5em;
    }
  </style>
</head>
<body>
  <div id="game">
    <h2>D√°ma ‚Äì hr√°ƒç vs. automat (s d√°mou üëë)</h2>
    <p>
      Hraje≈° za <strong>B√çL√â (‚ö™)</strong> a t√°hne≈° nahoru.<br>
      Klikni na svoji figurku a pak na c√≠lov√© pole. Automat hraje za <strong>ƒåERN√â (‚ö´)</strong>.<br>
      K√°men, kter√Ω dojde na konec, se zmƒõn√≠ na <strong>d√°mu üëë</strong> a m≈Ø≈æe chodit i zpƒõt a o v√≠ce pol√≠.
    </p>
    
    <div id="score">
      <span id="scoreWhite">B√≠l√Ω (‚ö™): 0</span> | 
      <span id="scoreBlack">ƒåern√Ω (‚ö´): 0</span>
    </div>

    <div id="board"></div>
    <div id="info"></div>
  </div>

  <script>
    const boardEl = document.getElementById("board");
    const infoEl = document.getElementById("info");
    const scoreWhiteEl = document.getElementById("scoreWhite");
    const scoreBlackEl = document.getElementById("scoreBlack");

    const SIZE = 8;

    // bu≈àka: null nebo { player: "w"|"b", king: true|false }
    let board = [];

    const humanPlayer = "w"; // b√≠l√©
    const aiPlayer = "b";    // ƒçern√©
    let currentPlayer = humanPlayer;
    let selected = null; // {row, col} nebo null

    // sk√≥re: kolik figur soupe≈ôe hr√°ƒç/AI sebrali
    let scoreWhite = 0; // b√≠l√Ω sebral ƒçern√©
    let scoreBlack = 0; // ƒçern√Ω sebral b√≠l√©

    function createPiece(player, king = false) {
      return { player, king };
    }

    function initBoard() {
      // pr√°zdn√° deska
      board = Array.from({ length: SIZE }, () =>
        Array.from({ length: SIZE }, () => null)
      );

      // ƒçern√© figurky naho≈ôe (≈ôady 0‚Äì2) na tmav√Ωch pol√≠ch
      for (let r = 0; r < 3; r++) {
        for (let c = 0; c < SIZE; c++) {
          if ((r + c) % 2 === 1) {
            board[r][c] = createPiece("b", false);
          }
        }
      }

      // b√≠l√© figurky dole (≈ôady 5‚Äì7) na tmav√Ωch pol√≠ch
      for (let r = 5; r < 8; r++) {
        for (let c = 0; c < SIZE; c++) {
          if ((r + c) % 2 === 1) {
            board[r][c] = createPiece("w", false);
          }
        }
      }

      currentPlayer = humanPlayer;
      selected = null;
      scoreWhite = 0;
      scoreBlack = 0;
      updateScore();
      render();
      updateInfo();
    }

    function updateInfo(message) {
      if (message) {
        infoEl.textContent = message;
        return;
      }
      if (currentPlayer === humanPlayer) {
        infoEl.textContent = "Na tahu: B√çL√ù (ty)";
      } else {
        infoEl.textContent = "Na tahu: ƒåERN√ù (automat)";
      }
    }

    function updateScore() {
      scoreWhiteEl.textContent = `B√≠l√Ω (‚ö™): ${scoreWhite}`;
      scoreBlackEl.textContent = `ƒåern√Ω (‚ö´): ${scoreBlack}`;
    }

    function render() {
      boardEl.innerHTML = "";

      for (let r = 0; r < SIZE; r++) {
        for (let c = 0; c < SIZE; c++) {
          const square = document.createElement("div");
          square.classList.add("square");
          square.classList.add((r + c) % 2 === 0 ? "light" : "dark");
          square.dataset.row = r;
          square.dataset.col = c;

          if (selected && selected.row === r && selected.col === c) {
            square.classList.add("selected");
          }

          const cell = board[r][c];
          if (cell) {
            const pieceEl = document.createElement("div");
            pieceEl.classList.add("piece");
            pieceEl.classList.add(cell.player === "w" ? "white" : "black");

            if (cell.king) {
              pieceEl.classList.add("king");
              const crown = document.createElement("div");
              crown.className = "crown";
              crown.textContent = "üëë";
              pieceEl.appendChild(crown);
            }

            square.appendChild(pieceEl);
          }

          square.addEventListener("click", () => handleClick(r, c));
          boardEl.appendChild(square);
        }
      }
    }

    function handleClick(row, col) {
      // hr√°ƒç sm√≠ tahat jen kdy≈æ je na tahu
      if (currentPlayer !== humanPlayer) {
        return;
      }

      const cell = board[row][col];

      // kdy≈æ m√°m vybranou figurku a kliknu na jin√© pole => pokus o tah
      if (selected && (selected.row !== row || selected.col !== col)) {
        attemptHumanMove(selected.row, selected.col, row, col);
        return;
      }

      // vybr√°n√≠ sv√© figurky
      if (cell && cell.player === humanPlayer) {
        selected = { row, col };
        render();
      }
    }

    function isOnBoard(r, c) {
      return r >= 0 && r < SIZE && c >= 0 && c < SIZE;
    }

    // valider pohybu (pro hr√°ƒçe i AI)
    function validateMove(player, r1, c1, r2, c2) {
      if (!isOnBoard(r1, c1) || !isOnBoard(r2, c2)) {
        return { valid: false };
      }

      const piece = board[r1][c1];
      if (!piece || piece.player !== player) {
        return { valid: false };
      }

      // c√≠lov√© pole mus√≠ b√Ωt pr√°zdn√©
      if (board[r2][c2] !== null) {
        return { valid: false };
      }

      const dr = r2 - r1;
      const dc = c2 - c1;

      if (dr === 0 || Math.abs(dr) !== Math.abs(dc)) {
        return { valid: false };
      }

      const stepR = dr > 0 ? 1 : -1;
      const stepC = dc > 0 ? 1 : -1;
      const dist = Math.abs(dr);

      // --- PRAVIDLA PRO KR√ÅLE (king) ---
      if (piece.king) {
        const captured = [];
        let r = r1 + stepR;
        let c = c1 + stepC;

        while (!(r === r2 && c === c2)) {
          const cell = board[r][c];
          if (cell) {
            if (cell.player === player) {
              // vlastn√≠ k√°men v cestƒõ = neplatn√©
              return { valid: false };
            } else {
              // soupe≈ô≈Øv k√°men ‚Äì p≈ôid√°me do seznamu sebran√Ωch
              captured.push({ r, c });
            }
          }
          r += stepR;
          c += stepC;
        }

        if (captured.length === 0) {
          // prost√Ω posun bez bran√≠ o v√≠ce pol√≠
          return { valid: true };
        } else {
          // skok kr√°le p≈ôes jeden nebo v√≠ce soupe≈ôov√Ωch kamen≈Ø
          return {
            valid: true,
            capture: true,
            captured,
          };
        }
      }

      // --- PRAVIDLA PRO OBYƒåEJN√ù K√ÅMEN ---
      const forwardDir = player === "w" ? -1 : 1;
      if (stepR !== forwardDir) {
        return { valid: false };
      }

      // jednoduch√Ω tah (bez bran√≠) ‚Äì jen o jedno pole vp≈ôed
      if (dist === 1) {
        return {
          valid: true,
        };
      }

      // p≈ôeskok ‚Äì m≈Ø≈æe p≈ôeskoƒçit nƒõkolik soupe≈ôov√Ωch kamen≈Ø po jedn√© diagon√°le vp≈ôed
      const captured = [];
      let r = r1 + stepR;
      let c = c1 + stepC;

      while (!(r === r2 && c === c2)) {
        const cell = board[r][c];

        // mus√≠ b√Ωt souvisl√° ≈ôada soupe≈ôov√Ωch kamen≈Ø
        if (!cell || cell.player === player) {
          return { valid: false };
        }

        captured.push({ r, c });
        r += stepR;
        c += stepC;
      }

      if (captured.length === 0) {
        return { valid: false };
      }

      return {
        valid: true,
        capture: true,
        captured,
      };
    }

    function promoteIfNeeded(player, r, piece) {
      if (!piece.king) {
        if (player === "w" && r === 0) {
          piece.king = true;
        } else if (player === "b" && r === SIZE - 1) {
          piece.king = true;
        }
      }
    }

    function attemptHumanMove(r1, c1, r2, c2) {
      const cell = board[r1][c1];
      if (!cell || cell.player !== humanPlayer) {
        selected = null;
        render();
        return;
      }

      const res = validateMove(humanPlayer, r1, c1, r2, c2);
      if (!res.valid) {
        selected = null;
        render();
        return;
      }

      // provedeme tah
      const piece = board[r1][c1];
      board[r1][c1] = null;
      board[r2][c2] = piece;

      // bran√≠
      if (res.capture && res.captured) {
        res.captured.forEach(pos => {
          if (board[pos.r][pos.c] && board[pos.r][pos.c].player === aiPlayer) {
            scoreWhite++;
          }
          board[pos.r][pos.c] = null;
        });
        updateScore();
      }

      // p≈ô√≠padn√° promoce na d√°mu
      promoteIfNeeded(humanPlayer, r2, piece);

      selected = null;
      render();

      // po hr√°ƒçovƒõ tahu jde na ≈ôadu automat
      currentPlayer = aiPlayer;
      updateInfo();
      setTimeout(() => {
        makeAIMove();
      }, 500);
    }

    // --- AI (jednoduch√°, ale zn√° d√°my & v√≠ce-kamenov√© skoky v jedn√© linii) ---

    function getAllMovesFor(player) {
      const moves = [];

      for (let r1 = 0; r1 < SIZE; r1++) {
        for (let c1 = 0; c1 < SIZE; c1++) {
          const cell = board[r1][c1];
          if (!cell || cell.player !== player) continue;

          // Zkus√≠me v≈°echny c√≠lov√© pozice na ≈°achovnici
          for (let r2 = 0; r2 < SIZE; r2++) {
            for (let c2 = 0; c2 < SIZE; c2++) {
              const res = validateMove(player, r1, c1, r2, c2);
              if (res.valid) {
                moves.push({
                  from: { r: r1, c: c1 },
                  to: { r: r2, c: c2 },
                  capture: !!res.capture,
                  captured: res.captured || [],
                });
              }
            }
          }
        }
      }

      return moves;
    }

    function makeAIMove() {
      const moves = getAllMovesFor(aiPlayer);
      if (moves.length === 0) {
        currentPlayer = humanPlayer;
        updateInfo("Automat nem√° ≈æ√°dn√Ω tah. Jsi na tahu d√°l.");
        return;
      }

      // p≈ôednost maj√≠ tahy s bran√≠m
      const captureMoves = moves.filter(m => m.capture);
      let chosen;
      if (captureMoves.length > 0) {
        chosen = captureMoves[Math.floor(Math.random() * captureMoves.length)];
      } else {
        chosen = moves[Math.floor(Math.random() * moves.length)];
      }

      applyAIMove(chosen);
      render();
      updateScore();

      // po tahu automatu je na ≈ôadƒõ hr√°ƒç
      currentPlayer = humanPlayer;
      updateInfo();
    }

    function applyAIMove(move) {
      const from = move.from;
      const to = move.to;
      const piece = board[from.r][from.c];

      board[from.r][from.c] = null;
      board[to.r][to.c] = piece;

      if (move.capture && move.captured) {
        move.captured.forEach(pos => {
          if (board[pos.r][pos.c] && board[pos.r][pos.c].player === humanPlayer) {
            scoreBlack++;
          }
          board[pos.r][pos.c] = null;
        });
      }

      promoteIfNeeded(aiPlayer, to.r, piece);
    }

    initBoard();
  </script>
</body>
</html>
